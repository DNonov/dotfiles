#! /bin/bash

HASH="%C(red)%h%C(reset)"
RELATIVE_TIME="%C(green)[%ar]%C(reset)"
AUTHOR="%C(blue)<%an>%C(reset)"
REFS="%C(red)%d%C(reset)"
SUBJECT="%C(white)%s%C(reset)"

FORMAT="$HASH $REFS $SUBJECT $AUTHOR $RELATIVE_TIME"

git log --graph --pretty="tformat:$FORMAT" $* |
  fzf --ansi --preview "echo {} |
  grep -o '[a-f0-9]\{7\}' |
  head -1 |
  xargs -I % sh -c 'git show --color=always %'" \
    --bind "enter:execute:
        (grep -o '[a-f0-9]\{7\}' |
          head -1 |
          xargs -I % sh -c 'git show --color=always % |
          less -R'
        ) << 'FZF-EOF'
        {}
  FZF-EOF"